// Generated by CoffeeScript 1.6.2
(function() {
  var PORT, RedisSessions, app, express, rs;

  PORT = 8101;

  RedisSessions = require("redis-sessions");

  rs = new RedisSessions();

  express = require('express');

  app = express();

  app.use(function(req, res, next) {
    res.removeHeader("X-Powered-By");
    next();
  });

  app.configure(function() {
    app.use(express.logger("dev"));
    return app.use(express.bodyParser());
  });

  app.post('/:app/:id', function(req, res) {
    res.header('Content-Type', "application/json");
    return rs.create({
      app: req.params.app,
      id: req.params.id,
      ttl: req.param('ttl'),
      ip: req.param('ip')
    }, function(err, resp) {
      if (err) {
        res.send(err, 500);
        return;
      }
      res.send(resp);
    });
  });

  app.get('/:app/:token', function(req, res) {
    res.header('Content-Type', "application/json");
    return rs.get({
      app: req.params.app,
      token: req.params.token
    }, function(err, resp) {
      if (err) {
        res.send(err, 500);
        return;
      }
      res.send(resp);
    });
  });

  app.listen(PORT);

}).call(this);
